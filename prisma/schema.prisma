generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    //output = "/home/ubuntu/reversa_leiloes/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// Modelo de Usuário com campos de NextAuth + campos customizados
model User {
  id                String    @id @default(cuid())
  name              String?
  email             String    @unique
  emailVerified     DateTime?
  image             String?
  password          String
  
  // Campos adicionais para cadastro
  cpf               String    @unique
  telefone          String
  cep               String
  endereco          String
  numero            String
  complemento       String?
  bairro            String
  cidade            String
  estado            String
  
  // Status de aprovação e documentos
  statusAprovacao   String    @default("pendente") // pendente, aprovado, reprovado
  docFrenteUrl      String?
  docVersoUrl       String?
  selfieUrl         String?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relações
  accounts          Account[]
  sessions          Session[]
  lances            Lance[]
  
  @@map("users")
}

// Modelos NextAuth
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// Modelo de Lote
model Lote {
  id            String    @id @default(cuid())
  numero        Int       @unique @default(autoincrement())
  titulo        String
  descricao     String
  origem        String?   // Devolução Marketplace, Caixa Amassada, Open Box, etc.
  lanceInicial  Float
  lanceAtual    Float?
  status        String    @default("ativo") // ativo, encerrado, cancelado
  dataInicio    DateTime
  dataFim       DateTime
  fotosUrls     String[]  @default([])
  videosUrls    String[]  @default([])
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relações
  lances        Lance[]
  
  @@map("lotes")
}

// Modelo de Lance
model Lance {
  id          String    @id @default(cuid())
  valor       Float
  
  loteId      String
  lote        Lote      @relation(fields: [loteId], references: [id], onDelete: Cascade)
  
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  
  @@map("lances")
  @@index([loteId])
  @@index([userId])
}

// Modelo de Admin
model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  nome      String
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("admins")
}

// Modelo de Banner do Site
model Banner {
  id        String   @id @default(cuid())
  titulo    String?
  imageUrl  String
  link      String?
  ordem     Int      @default(0)
  ativo     Boolean  @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("banners")
}
